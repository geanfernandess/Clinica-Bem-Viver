<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Clínica Bem Viver</title>
    <meta name="description" content="Descrição da Clínica....">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" 
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>

<body>
    <header class="listaMenu">
        <div class="row g-3">
            <div class="col-sm-4">
                <img src="images/logo_clinica.png" alt="Logomarca da Clínica" width="45" height="45">
            </div>
            <div class="col-sm-4">
                <h2>Clínica Bem Viver</h2>
            </div>
        </div>
    </header>  
    <!-- <nav>
        <ul class="listaMenuInterno palavrasMenuInterno"> 
            <li><a href="restritoPrincipal.php">Principal</a></li> 
            <li><a href="restritoFormFuncionario.html">Novo Funcionário</a></li> 
            <li><a href="restritoFormPaciente.html">Novo Paciente</a></li>
            <li><a href="restritoListaFuncionarios.php">Listar Funcionários</a></li>
            <li><a href="restritoListaPacientes.php">Listar Pacientes</a></li>
            <li><a href="restritoListaBaseEnderecos.php">Listar Endereços</a></li>
            <li><a href="#">Listar todos Agendamentos</a></li>
            <li><a href="#">Listar meus Agendamentos</a></li>
        </ul>
    </nav> -->
    <div class="container">
        <main>
            <form action="restritoCadastraPaciente.php" name="formCadastroPaciente" method="post" class="row g-3">
                <fieldset>
                    <legend><h2>Formulário Paciente</h2></legend>

                    <div class="row g-3">
                        <div class="col-sm-8">
                            <label for="nome" class="form-label form-label-sm">Nome</label>
                            <input type="text" class="form-control form-control-sm" id="nome" name="nome">
                            <span></span>
                        </div>
                        <div class="col-sm-4">
                            <label for="sexo" class="form-label form-label-sm">Sexo</label>
                            <input type="text" class="form-control form-control-sm" id="sexo" name="sexo">
                            <span></span>
                        </div>
                        <div class="col-sm-8">
                            <label for="email" class="form-label form-label-sm">E-mail</label>
                            <input type="email" class="form-control form-control-sm" id="email" name="email">
                            <span></span>
                        </div>
                        <div class="col-sm-4">
                            <label for="telefone" class="form-label form-label-sm">Telefone</label>
                            <input type="tel" class="form-control form-control-sm" id="telefone" name="telefone" placeholder="(xx) xxxxx-xxxx">
                            <span></span>
                        </div>
                        <div class="col-sm-4">
                            <label for="cep" class="form-label form-label-sm">CEP no formato xxxxx-xxx (Ex:38400-100)</label>
                            <input type="text" class="form-control form-control-sm" id="cep" name="cep">
                            <span></span>
                        </div>
                        <div class="col-sm-8">
                            <label for="logradouro" class="form-label form-label-sm">Logradouro</label>
                            <input type="text" class="form-control form-control-sm" id="logradouro" name="logradouro">
                            <span></span>
                        </div>
                        <div class="col-sm-8">
                            <label for="cidade" class="form-label form-label-sm">Cidade</label>
                            <input type="text" class="form-control form-control-sm" id="cidade" name="cidade">
                            <span></span>
                        </div>
                        <div class="col-sm-4">
                            <label for="estado" class="form-label form-label-sm">Estado</label>
                            <select class="form-select form-select-sm" name="estado" id="estado">
                                <option value="Selecione" selected>Selecione</option>
                                <option value="ACRE">AC</option>
                                <option value="ALAGOAS">AL</option>
                                <option value="AMAPA">AP</option>
                                <option value="AMAZONAS">AM</option>
                                <option value="BAHIA">BA</option>
                                <option value="CEARA">CE</option>
                                <option value="DISTRITO FEDERAL">DF</option>
                                <option value="ESPIRITO SANTO">ES</option>
                                <option value="GOIAS">GO</option>
                                <option value="MARANHAO">MA</option>
                                <option value="MATO GROSSO">MT</option>
                                <option value="MATO GROSSO DO SUL">MS</option>
                                <option value="MINAS GERAIS">MG</option>
                                <option value="PARA">PA</option>
                                <option value="PARAIBA">PB</option>
                                <option value="PARANA">PR</option>
                                <option value="PERNAMBUCO">PE</option>
                                <option value="PIAUI">PI</option>
                                <option value="RIO DE JANEIRO">RJ</option>
                                <option value="RIO GRANDE DO NORTE">RN</option>
                                <option value="RIO GRANDE DO SUL">RS</option>
                                <option value="RONDONIA">RO</option>
                                <option value="RORAIMA">RR</option>
                                <option value="SANTA CATARINA">SC</option>
                                <option value="SAO PAULO">SP</option>
                                <option value="SERGIPE">SE</option>
                                <option value="TOCANTINS">TO</option>
                            </select>
                            <span></span>
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <div class="row g-3">
                        <div class="col-sm-4">
                            <label for="peso" class="form-label form-label-sm">Peso</label>
                            <input type="text" class="form-control form-control-sm" id="peso" name="peso">
                            <span></span>
                        </div>
                        <div class="col-sm-4">
                            <label for="altura" class="form-label form-label-sm">Altura</label>
                            <input type="number" class="form-control form-control-sm" id="altura" name="altura" value="170">
                            <span></span>
                        </div>
                        <div class="col-sm-4">
                            <label for="tipoSanguineo" class="form-label form-label-sm">Tipo Sanquineo</label>
                            <input type="text" class="form-control form-control-sm" id="tipoSanguineo" name="tipoSanguineo">
                            <span></span>
                        </div>
                </fieldset>
                <div class="col-sm-12 divButton">
                    <button type="submit" class="btn btn-dark">Cadastrar Paciente</button>
                </div>
            </form>
            <div class="centralizaTexto btnInterno">
                <a href="restritoPrincipal.php">Voltar para Página Principal</a>
            </div>
        </main>

        <script>
            window.onload = function () {
                document.forms.formCadastroPaciente.onsubmit = validaForm;

                // Parte da pagina responsavel por buscar o endereço na tabela base de endereços
                const inputCep = document.querySelector("#cep");
                inputCep.onkeyup = () => buscaEndereco(inputCep.value);
            }


            function buscaEndereco(cep) {
                if (cep.length != 9) return;

                let xhr = new XMLHttpRequest();
                xhr.open("GET", "buscaEndereco.php?cep=" + cep, true);

                xhr.onload = function () {
                    
                    // verifica o código de status retornado pelo servidor
                    if (xhr.status != 200) {
                        console.error("Falha inesperada: " + xhr.responseText);
                        return;
                    }

                    // converte a string JSON para objeto JavaScript
                    try {
                        var endereco = JSON.parse(xhr.responseText);
                    }
                    catch (e) {
                        console.error("String JSON inválida: " + xhr.responseText);
                        return;
                    }

                    // utiliza os dados retornados para preencher formulário
                    formCadastroPaciente.logradouro.value = endereco.logradouro;
                    formCadastroPaciente.cidade.value = endereco.cidade;
                    formCadastroPaciente.estado.value = endereco.estado;
                }

                xhr.onerror = function () {
                    console.error("Erro de rede - requisição não finalizada");
                };

                xhr.send();
            }
    
            
            function validaForm (e) {
                let form = e.target;
                let formValido = true;

                const spanNome = form.nome.nextElementSibling;
                const spanSexo = form.sexo.nextElementSibling;
                const spanEmail = form.email.nextElementSibling;
                const spanTelefone = form.telefone.nextElementSibling;
                const spanCep = form.cep.nextElementSibling;
                const spanLogradouro = form.logradouro.nextElementSibling;
                const spanCidade = form.cidade.nextElementSibling;
                const spanEstado = form.estado.nextElementSibling;
                const spanPeso = form.peso.nextElementSibling;
                const spanTipoSanguineo = form.tipoSanguineo.nextElementSibling;
    
                spanNome.textContent = "";
                spanSexo.textContent = "";
                spanEmail.textContent = "";
                spanTelefone.textContent = "";
                spanCep.textContent = "";
                spanLogradouro.textContent = "";
                spanCidade.textContent = "";
                spanEstado.textContent = "";
                spanPeso.textContent = "";
                spanTipoSanguineo.textContent = "";

                if (form.nome.value === "") {
                    spanNome.textContent = 'O nome deve ser preenchido';
                    formValido = false;
                }

                if (form.sexo.value === "") {
                    spanSexo.textContent = 'O sexo deve ser preenchido';
                    formValido = false;
                }

                if (form.email.value === "") {
                    spanEmail.textContent = 'O e-mail deve ser preenchido';
                    formValido = false;
                }

                if (form.telefone.value === "") {
                    spanTelefone.textContent = 'O telefone deve ser preenchido';
                    formValido = false;
                }

                if (form.cep.value === "") {
                    spanCep.textContent = 'O CEP deve ser preenchido';
                    formValido = false;
                }
    
                if (form.logradouro.value === "") {
                    spanLogradouro.textContent = 'O logradouro deve ser preenchido';
                    formValido = false;
                }

                if (form.cidade.value === "") {
                    spanCidade.textContent = 'A cidade deve ser preenchida';
                    formValido = false;
                }

                if (form.estado.value === "Selecione") {
                    spanEstado.textContent = 'O estado deve ser selecionado';
                    formValido = false;
                }

                if (form.peso.value === "") {
                    spanPeso.textContent = 'O peso deve ser preenchido';
                    formValido = false;
                }

                if (form.altura.value === "") {
                    spanAltura.textContent = 'A altura deve ser preenchido';
                    formValido = false;
                }

                if (form.tipoSanguineo.value === "") {
                    spanTipoSanguineo.textContent = 'O tipo sanguineo deve ser preenchido';
                    formValido = false;
                }
    
                return formValido;
            }
        </script>

    </div>
    <footer>
        <p>© Copyright 2021. Todos os direitos reservados.</p>
    </footer>

</body>

</html>